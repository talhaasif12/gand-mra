<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="data.js"></script>
</head>
<body>
    <header>
        <h1>Admin Dashboard</h1>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </header>

    <div class="container">
        
        <!-- USER REGISTRATION SECTION -->
        <div class="card">
            <h2>User Registration</h2>
            <div class="form-grid">
                <div>
                    <label>User ID</label>
                    <input type="text" id="u-id" placeholder="e.g. 24F-3113 or 101">
                </div>
                <div>
                    <label>Full Name</label>
                    <input type="text" id="u-name" placeholder="Enter Full Name">
                </div>
                <div>
                    <label>Role</label>
                    <select id="u-role" onchange="toggleProgram()">
                        <option value="student">Student</option>
                        <option value="teacher">Teacher</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div>
                    <label>Program (Students Only)</label>
                    <select id="u-prog">
                        <option value="SE">Software Engineering (SE)</option>
                        <option value="CS">Computer Science (CS)</option>
                        <option value="AI">Artificial Intelligence (AI)</option>
                    </select>
                </div>
                <div style="grid-column: span 2;">
                    <label>Password</label>
                    <input type="password" id="u-pass" placeholder="Create Password">
                </div>
            </div>
            <button onclick="submitUser()">Register New User</button>
        </div>

        <!-- COURSE ALLOCATION SECTION -->
        <div class="card">
            <h2>Course Allocation</h2>
            <div class="form-grid">
                <div>
                    <label>Course Name</label>
                    <input type="text" id="c-name" placeholder="e.g. Programming Fundamentals">
                </div>
                <div>
                    <label>Program</label>
                    <select id="c-prog">
                        <option value="SE">SE</option>
                        <option value="CS">CS</option>
                        <option value="AI">AI</option>
                    </select>
                </div>
                <div>
                    <label>Section</label>
                    <input type="text" id="c-sec" placeholder="e.g. A">
                </div>
                <div>
                    <label>Teacher</label>
                    <select id="c-teacher"></select>
                </div>
            </div>
            <button onclick="submitCourse()">Assign Course</button>
        </div>

        <!-- ACTIVE COURSES SECTION -->
        <div class="card">
            <h2>Active Courses</h2>
            <table>
                <thead>
                    <tr>
                        <th>Course</th>
                        <th>Program</th>
                        <th>Section</th>
                        <th>Teacher</th>
                    </tr>
                </thead>
                <tbody id="course-table"></tbody>
            </table>
        </div>
    </div>

    <script>
        checkSession('admin');

        function toggleProgram() {
            const role = document.getElementById('u-role').value;
            document.getElementById('u-prog').disabled = (role !== 'student');
        }

        function loadData() {
            const users = getAllUsers();
            const teachers = users.filter(u => u.role === 'teacher');
            const select = document.getElementById('c-teacher');
            select.innerHTML = "";
            
            if (teachers.length === 0) {
                select.innerHTML = "<option value=''>No Teachers Available</option>";
            } else {
                teachers.forEach(t => {
                    select.innerHTML += `<option value="${t.id}">${t.name}</option>`;
                });
            }

            const courses = getAllCourses();
            const tbody = document.getElementById('course-table');
            tbody.innerHTML = "";
            
            if (courses.length === 0) {
                tbody.innerHTML = "<tr><td colspan='4' style='text-align:center; color:#999;'>No courses created yet</td></tr>";
            } else {
                courses.forEach(c => {
                    tbody.innerHTML += `<tr><td>${c.name}</td><td>${c.program}</td><td>${c.section}</td><td>${c.teacherName}</td></tr>`;
                });
            }
        }

        function submitUser() {
            const id = document.getElementById('u-id').value.trim();
            const name = document.getElementById('u-name').value.trim();
            const role = document.getElementById('u-role').value;
            const prog = document.getElementById('u-prog').value;
            const pass = document.getElementById('u-pass').value.trim();

            if(!id || !name || !pass) return alert("Please fill all required fields");
            if(role === 'student' && !/^24[FPLIMK]-\d{4}$/.test(id)) return alert("Invalid Student ID! Use format: 24F-XXXX");
            if(role === 'teacher' && !/^\d+$/.test(id)) return alert("Teacher ID must be numbers only");

            const res = registerUser(id, name, role, pass, prog);
            alert(res.msg);
            if(res.success) location.reload();
        }

        function submitCourse() {
            const name = document.getElementById('c-name').value.trim();
            const prog = document.getElementById('c-prog').value;
            const sec = document.getElementById('c-sec').value.trim();
            const tid = document.getElementById('c-teacher').value;
            
            if(!name || !sec || !tid) return alert("Please fill all fields");
            
            createCourse(name, prog, sec, tid);
            alert("Course Created Successfully");
            loadData();
        }

        loadData();
    </script>
</body>
</html>
